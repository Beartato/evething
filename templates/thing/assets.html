{% extends "base.html" %}
{% load thing_extras %}
{% load mptt_tags %}

{% block title %}Assets{% endblock %}

{% comment %}{% block extra_head %}
  <script type="text/javascript">
  $(document).ready(function (){
    $("#add-filter").on('click', 'add-filter-click');
  });
  </script>
{% endblock %}{% endcomment %}

{% block content %}
      <div class="row-fluid">
        <div class="span8 alert alert-error">
          <i class="icon-info-sign"></i> <strong>WORK IN PROGRESS:</strong> this is pretty obviously a work in
          progress, more filter types need to be added and stuff.
        </div>
      </div>
      
      <div class="row-fluid">
        <div class="span6">
          <h2>Assets</h2>

          <form class="well well-small" action="{% url thing.views.assets %}" method="GET">
            <h4>Filters</h4>
            <fieldset>
              <select name="filter_type">
                <option value="char">Character</option>
              </select>
              <select name="filter_comp" class="input-small">
                <option value="eq">=</option>
                <option value="ne">!=</option>
              </select>
              <select name="filter_value">
                <option value=""></option>
                {% for character in characters %}
                <option value="{{ character.eve_character_id }}">{{ character.name }}</option>
                {% endfor %}
              </select>
            </fieldset>
            {% comment %}<button id="add-filter" class="btn btn-primary"><i class="icon-plus icon-white"></i> Add filter</button>{% endcomment %}
            <button type="submit" class="btn btn-primary">Apply filters</button>
          </form>
        </div>
      </div>

      <div class="row-fluid">
        <div class="span10">
          <p><strong>Total asset value:</strong> {{ total_value|commas }} ISK</p>
          {% for system_name, asset_roots in systems %}
          <table class="table table-striped table-bordered table-condensed">
            <thead>
              <tr class="c">
                <th class="l" colspan="2">{{ system_name }}</th>
                <th class="c">Group</th>
                <th class="c">Quantity</th>
                <th class="c">Unit Value</th>
                <th class="c">Total Value</th>
              </tr>
            </thead>
            <tbody>
              {% for asset in asset_roots %}
              <tr>
                <td class="assets-character">
                  {{ asset.character.name }}
                </td>
                {% comment %}<td class="assets-img">
                  <img class="nomargin" src="http://image.eveonline.com/Type/{{ asset.item_id }}_32.png">
                </td>{% endcomment %}
                <td class="assets-item">
                  {% if asset.z_contents %}<i class="icon-plus"></i> {% endif %}
                  {{ asset.item.name }}
                  {% if asset.name %} - <i>{{ asset.name }}</i>{% endif %}
                </td>
                <td class="assets-type c">
                  {{ asset.item.item_group.category.name }}
                </td>
                <td class="assets-quantity r">
                  {{ asset.quantity|commas }}
                </td>
                <td class="assets-value r">
                  {{ asset.item.sell_price|commas }} ISK
                </td>
                <td class="assets-value r">
                  {{ asset.z_total|commas }} ISK
                </td>
              </tr>
              {% endfor %}{% comment %}in asset_roots{% endcomment %}
              <tr>
                <td colspan="4"></td>
                <td class="assets-total r" colspan="2">{{ loc_totals|dictlookup:system_name|commas }} ISK</td>
              </tr>
            </tbody>
          </table>
          {% endfor %}{% comment %}in systems{% endcomment %}
        </div>
      </div>
{% endblock %}
