{% extends "base.html" %}
{% load thing_extras %}

{% block title %}Character: {{ char.name }}{% endblock %}

{% block content %}
      <div class="row">
        <div class="span3">
          <div class="thumbnail">
            <img src="http://image.eveonline.com/Character/{{ char.eve_character_id }}_256.jpg">
          </div>
          
          {% if not public %}
          <br>
          <div class="well">
            <h3>Settings</h3>
            <form action="{% url evething.thing.views.character_settings char.name %}" method="POST" style="margin: 0">
              {% csrf_token %}
              <input type="hidden" name="character_id" value="{{ char.eve_character_id }}">
              <label class="checkbox">
                <input type="checkbox" name="public"{% if config.is_public %} checked{% endif %}>
                Publicly visible
              </label>
              <label class="checkbox">
                <input type="checkbox" name="clone"{% if config.show_clone %} checked{% endif %}>
                Show clone information
              </label>
              <label class="checkbox">
                <input type="checkbox" name="implants"{% if config.show_implants %} checked{% endif %}>
                Show implants
              </label>
              <label class="checkbox">
                <input type="checkbox" name="queue"{% if config.show_skill_queue %} checked{% endif %}>
                Show skill queue
              </label>
              <label class="checkbox">
                <input type="checkbox" name="wallet"{% if config.show_wallet %} checked{% endif %}>
                Show wallet balance
              </label>
              <button type="submit" class="btn btn-primary">Save</button>
            </form>
          </div>
          {% endif %}
        </div>
        <div class="span9">
          <h2>{{ char.name }}</h2>
          <div class="row">
            <div class="span7">
              <div class="row">
                <div class="span4">
                  <p><strong>Wallet:</strong> {% if not public or config.show_wallet %}{{ char.wallet_balance|commas }}{% else %}??{% endif %} ISK</p>
                  <ul class="unstyled">
                    <li><strong>Total SP:</strong> {{ char.get_total_skill_points|commas }}</li>
                    {% if not public or config.show_clone %}
                    <li><strong>Clone limit:</strong> {{ char.clone_skill_points|commas }}</li>
                    <li>{{ char.clone_name }}</li>
                    {% endif %}
                  </ul>
                </div>
                <div class="span3 pull-right">
                  <table>
                    <tr class="r">
                      <td><strong>Int:</strong></td>
                      <td>{{ char.int_attribute }}</td>
                      <td>({% if not public or config.show_implants %}+{{ char.int_bonus }}{% else %}??{% endif %})</td>
                    </tr>
                    <tr class="r">
                      <td><strong>Mem:</strong></td>
                      <td>{{ char.mem_attribute }}</td>
                      <td>({% if not public or config.show_implants %}+{{ char.mem_bonus }}{% else %}??{% endif %})</td>
                    </tr>
                    <tr class="r">
                      <td><strong>Per:</strong></td>
                      <td>{{ char.per_attribute }}</td>
                      <td>({% if not public or config.show_implants %}+{{ char.per_bonus }}{% else %}??{% endif %})</td>
                    </tr>
                    <tr class="r">
                      <td><strong>Wil:</strong></td>
                      <td>{{ char.wil_attribute }}</td>
                      <td>({% if not public or config.show_implants %}+{{ char.wil_bonus }}{% else %}??{% endif %})</td>
                    </tr>
                    <tr class="r">
                      <td><strong>Cha:</strong></td>
                      <td>{{ char.cha_attribute }}</td>
                      <td>({% if not public or config.show_implants %}+{{ char.cha_bonus }}{% else %}??{% endif %})</td>
                    </tr>
                  </table>
                  <br>
                </div>
              </div>
            </div>
          </div>

          {% if not public or config.show_skill_queue %}
          {% if queue %}
          <div class="row">
            <div class="span9">
              <div class="well well-small alert-success black">
                <h3>Skill Queue</h3>
                <div>
                  {{ queue.0.skill.item.name }} {{ queue.0.get_roman_level }} (Rank {{ queue.0.skill.rank }}) --
                  {{ queue.0.get_remaining|duration }} remaining
                  <div class="pull-right">{{ queue.0.end_time|date:"Y-m-d H:i:s" }} UTC</div>
                  <div style="width: 100%">
                    <div class="progress margin-half-top">
                      <div class="bar" style="width: {{ queue.0.get_complete_percentage }}%">{{ queue.0.get_complete_percentage }}%</div>
                    </div>
                  </div>
                </div>
                {% if queue_rest %}
                <div class="margin-half-top">
                  {% for sq in queue_rest %}
                  <div>
                    {{ sq.skill.item.name }} {{ sq.get_roman_level }} (Rank {{ sq.skill.rank }})
                    <div class="pull-right">{{ sq.end_time|date:"Y-m-d H:i:s" }} UTC</div>
                  </div>
                  {% endfor %}
                </div>
                {% endif %}
                </ul>
              </div>
            </div>
          </div>
          {% endif %}{% endif %}

          {% for mg, css in skills.items %}
          <div class="row">
            <div class="span9">
              <div class="well well-small">
                <h3>{{ mg.name }}</h3>
                {% for cs in css %}
                <div>
                  {% spaceless %}
                  <span class="{% if cs.level == 5 %}level5{% endif %}">
                  {% if training_id == cs.skill.item.id %}<span class="training-highlight"><i class="icon-play"></i>{% endif %}
                  {{ cs.skill.item.name }} {{ cs.get_roman_level }} (Rank {{ cs.skill.rank }}) / SP: {{ cs.points|commas }} of {{ cs.skill.get_sp_at_level|commas }}
                  {% if training_id == cs.skill.item.id %}</span>{% endif %}
                  </span>
                  {% endspaceless %}
                  <div class="pull-right">
                    {% spaceless %}
                    {% for level in skill_loop %}
                    {% if cs.level == 5 %}<i class="icon-heart nomargin">
                    {% else %}{% if level <= cs.level %}<i class="icon-star nomargin">
                    {% else %}{% if cs.z_partial == level %}<i class="icon-star-empty nomargin">
                    {% else %}{% if cs.skill.item.id == training_id and level == training_level %}<i class="icon-star-empty nomargin">
                    {% else %}<i class="icon-minus nomargin">
                    {% endif %}{% endif %}{% endif %}{% endif %}
                    </i>
                    {% endfor %}
                    {% endspaceless %}
                  </div>
                </div>
                {% endfor %}
                <div class="margin-half-top">
                  <i class="icon-chevron-right"></i>
                  <strong>{{ css|length }}</strong> skill{{ css|length|pluralize }} trained for <strong>{{ mg.z_total_sp|commas }}</strong> SP</div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

{% endblock %}
